<?xml version="1.0"?>
<?xml-stylesheet type="text/xsl" href="configuration.xsl"?>

<configuration>

  <!-- YARN -->
  <property>
     <name>yarn.application.classpath</name>
     <value>
        $HADOOP_CONF_DIR,
        $HADOOP_COMMON_HOME/*,$HADOOP_COMMON_HOME/lib/*,
        $HADOOP_HDFS_HOME/*,$HADOOP_HDFS_HOME/lib/*,
        $HADOOP_MAPRED_HOME/*,$HADOOP_MAPRED_HOME/lib/*,
        $HADOOP_YARN_HOME/*,$HADOOP_YARN_HOME/lib/*,
        /etc/tez/conf/tez-container-log4j.properties
     </value>
  </property>

  <property>
    <name>yarn.log-aggregation-enable</name>
    <value><%= node['yarn_site']['log_aggregation_enable'] %></value>
  </property>

  <property>
    <name>yarn.scheduler.maximum-allocation-vcores</name>
    <value><%= node['yarn_site']['yarn_scheduler_maximum_allocation_vcores'] %></value>
  </property>

  <!-- YARN (MRv2) -->
  <property>
    <name>yarn.nodemanager.aux-services</name>
    <value>mapreduce_shuffle</value>
  </property>

  <property>
    <name>yarn.nodemanager.aux-services.mapreduce.shuffle.class</name>
    <value>org.apache.hadoop.mapred.ShuffleHandler</value>
  </property>

  <!-- ResourceManager HA -->
  <property>
    <name>yarn.resourcemanager.ha.enabled</name>
    <value>true</value>
  </property>

  <property>
    <name>yarn.resourcemanager.cluster-id</name>
    <value>rm-cluster</value>
  </property>

  <property>
    <name>yarn.resourcemanager.ha.rm-ids</name>
    <value>rm1,rm2</value>
  </property>

  <property>
    <name>yarn.resourcemanager.hostname.rm1</name>
    <value><%= node['yarn_site']['yarn_resourcemanager_hostname_rm1'] %></value>
  </property>

  <property>
    <name>yarn.resourcemanager.hostname.rm2</name>
    <value><%= node['yarn_site']['yarn_resourcemanager_hostname_rm2'] %></value>
  </property>

  <property>
    <name>yarn.resourcemanager.address.rm1</name>
    <value><%= node['yarn_site']['yarn_resourcemanager_address_rm1'] %></value>
  </property>

  <property>
    <name>yarn.resourcemanager.address.rm2</name>
    <value><%= node['yarn_site']['yarn_resourcemanager_address_rm2'] %></value>
  </property>

  <property>
    <name>yarn.resourcemanager.webapp.address.rm1</name>
    <value><%= node['yarn_site']['yarn_resourcemanager_webapp_address_rm1'] %></value>
  </property>

  <property>
    <name>yarn.resourcemanager.webapp.address.rm2</name>
    <value><%= node['yarn_site']['yarn_resourcemanager_webapp_address_rm2'] %></value>
  </property>

  <property>
    <name>yarn.resourcemanager.recovery.enabled</name>
    <value>true</value>
  </property>

  <property>
    <name>yarn.resourcemanager.store.class</name>
    <value>org.apache.hadoop.yarn.server.resourcemanager.recovery.ZKRMStateStore</value>
  </property>

  <property>
    <name>yarn.resourcemanager.ha.automatic-failover.enabled</name>
    <value>true</value>
  </property>

  <property>
    <name>yarn.resourcemanager.ha.automatic-failover.embedded</name>
    <value>true</value>
  </property>

  <!-- launch more than one ResourceManager on a single node -->
  <property>
    <name>yarn.resourcemanager.ha.id</name>
    <value><%= node['yarn_site']['yarn_resourcemanager_ha_id'] %></value>
  </property>

  <!-- NodeManager -->
  <property>
    <name>yarn.nodemanager.hostname</name>
    <value><%= node['yarn_site']['yarn_nodemanager_hostname'] %></value>
  </property>

  <property>
    <name>yarn.nodemanager.local-dirs</name>
    <value><%= node['yarn_site']['yarn_nodemanager_local_dirs'] %></value>
  </property>

  <property>
    <name>yarn.nodemanager.log-dirs</name>
    <value><%= node['yarn_site']['yarn_nodemanager_log_dirs'] %></value>
  </property>

  <property>
    <name>yarn.nodemanager.remote-app-log-dir</name>
    <value><%= node['yarn_site']['yarn_nodemanager_remote_app_log_dir'] %></value>
  </property>

  <!-- LXC -->
  <property>
    <name>yarn.nodemanager.container-executor.class</name>
    <value>org.apache.hadoop.yarn.server.nodemanager.LinuxContainerExecutor</value>
  </property>

  <property>
    <name>yarn.nodemanager.linux-container-executor.resources-handler.class</name>
    <value>org.apache.hadoop.yarn.server.nodemanager.util.CgroupsLCEResourcesHandler</value>
  </property>

  <property>
    <name>yarn.nodemanager.linux-container-executor.cgroups.hierarchy</name>
    <value>/hadoop-yarn</value>
  </property>

  <property>
    <name>yarn.nodemanager.linux-container-executor.cgroups.mount</name>
    <value>true</value>
  </property>

  <property>
    <name>yarn.nodemanager.linux-container-executor.cgroups.mount-path</name>
    <value>/cgroup</value>
  </property>

  <property>
    <name>yarn.nodemanager.linux-container-executor.group</name>
    <value>yarn</value>
  </property>

  <property>
    <name>yarn.nodemanager.linux-container-executor.nonsecure-mode.local-user</name>
    <value>yarn</value>
  </property>

  <!-- Application Master -->
<!--
  <property>
    <name>yarn.app.mapreduce.am.log.level</name>
    <value>DEBUG</value>
  </property>
-->

  <!-- JobHistory Server -->
  <property>
    <name>yarn.log.server.url</name>
    <value><%= node['yarn_site']['yarn_log_server_url'] %></value>
  </property>

  <!-- Timeline Server -->
  <property>
    <name>yarn.timeline-service.enabled</name>
    <value>true</value>
  </property>

  <property>
    <name>yarn.timeline-service.hostname</name>
    <value><%= node['yarn_site']['yarn_timeline_service_hostname'] %></value>
  </property>

  <property>
    <name>yarn.timeline-service.generic-application-history.enabled</name>
    <value>true</value>
  </property>

  <property>
    <name>yarn.timeline-service.generic-application-history.store-class</name>
    <value>org.apache.hadoop.yarn.server.applicationhistoryservice.FileSystemApplicationHistoryStore</value>
  </property>

  <property>
    <name>yarn.timeline-service.leveldb-timeline-store.path</name>
    <value><%= node['yarn_site']['yarn_timeline_service_leveldb_timeline_store_path'] %></value>
  </property>

  <!-- ZooKeeper -->
  <property>
    <name>yarn.resourcemanager.zk-address</name>
    <value><%= node['yarn_site']['yarn_resourcemanager_zk_address'] %></value>
  </property>

</configuration>
